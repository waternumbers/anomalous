<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cost Calculations • anomalous</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Cost Calculations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">anomalous</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/anomalous.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/categorical.html">Categorical Cost Calculations</a></li>
    <li><a class="dropdown-item" href="../../articles/old/cost_calcs.html">Cost Calculations</a></li>
    <li><a class="dropdown-item" href="../../articles/creating_cost_functions.html">Creating Cost Functions</a></li>
    <li><a class="dropdown-item" href="../../articles/crops.html">CROPS with anomalies</a></li>
    <li><a class="dropdown-item" href="../../articles/quantile.html">Quantile Cost Calculations</a></li>
    <li><a class="dropdown-item" href="../../articles/regression_cost_calcs.html">Regression Cost Calculations</a></li>
    <li><a class="dropdown-item" href="../../articles/replicate_cost_calcs.html">Replicate Cost Calculations</a></li>
    <li><a class="dropdown-item" href="../../articles/old/univariate_cost_calcs.html">Univariate Cost Calculations</a></li>
    <li><a class="dropdown-item" href="../../articles/univariate_gaussian.html">Univariate Gaussian Cost Calculations</a></li>
    <li><a class="dropdown-item" href="../../articles/univariate_poisson.html">Univariate Poisson Cost Calculations</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/waternumbers/anomalous/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cost Calculations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/anomalous/blob/main/vignettes/old/cost_calcs.Rmd" class="external-link"><code>vignettes/old/cost_calcs.Rmd</code></a></small>
      <div class="d-none name"><code>cost_calcs.Rmd</code></div>
    </div>

    
    
<p>The purpose of this vignette is to present the calculations of the
costs for various distribution.</p>
<p>In the follow variables identified by Greek letters are considered
known <em>a priori</em>.</p>
<div class="section level2">
<h2 id="univariate-independent-gaussian">Univariate Independent Gaussian<a class="anchor" aria-label="anchor" href="#univariate-independent-gaussian"></a>
</h2>
<p>Data belongs to group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
whose time stamps are the set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>k</mi></msub><annotation encoding="application/x-tex">T_{k}</annotation></semantics></math>
can have additive mean anomaly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mi>k</mi></msub><annotation encoding="application/x-tex">m_{k}</annotation></semantics></math>
and multiplicative variance anomaly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>k</mi></msub><annotation encoding="application/x-tex">s_{k}</annotation></semantics></math>
which are common for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">t \in T_{k}</annotation></semantics></math>.
For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">t \in T_{k}</annotation></semantics></math>
this gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>s</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><msqrt><mrow><mn>2</mn><mi>π</mi><msub><mi>σ</mi><mi>t</mi></msub><msub><mi>s</mi><mi>k</mi></msub></mrow></msqrt></mfrac><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mfrac><mn>1</mn><mrow><mn>2</mn><msub><mi>σ</mi><mi>t</mi></msub><msub><mi>s</mi><mi>k</mi></msub></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>−</mo><msub><mi>m</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
P\left(y_t \left| \mu_t,m_k,\sigma_k,s_k\right.\right) = \frac{1}{\sqrt{2\pi\sigma_{t}s_{k}}}\exp\left(-\frac{1}{2\sigma_{t}s_{k}}\left(y_{t} - \mu_t - m_{k}\right)^2\right)
</annotation></semantics></math></p>
<p>with the likelihood of of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>k</mi></msub><annotation encoding="application/x-tex">n_{k}</annotation></semantics></math>
observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><annotation encoding="application/x-tex">y_{t \in T_{k}}</annotation></semantics></math>
being
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>s</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><msub><mi>s</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><msub><mi>n</mi><mi>k</mi></msub><mi>/</mi><mn>2</mn></mrow></msup><munder><mo>∏</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msubsup><mi>σ</mi><mi>t</mi><mrow><mo>−</mo><mn>1</mn><mi>/</mi><mn>2</mn></mrow></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mfrac><mn>1</mn><mrow><mn>2</mn><msub><mi>s</mi><mi>k</mi></msub></mrow></mfrac><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>−</mo><msub><mi>m</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
L\left(y_{t \in T_{k}} \left| \mu_t,m_k,\sigma_k,s_k\right.\right) = 
\left(2\pi s_{k}\right)^{-n_{k}/2} 
\prod\limits_{t \in T_{k}} \sigma_{t}^{-1/2}
\exp\left(-\frac{1}{2s_{k}}\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t - m_{k}\right)^2}{\sigma_{t}}\right)
</annotation></semantics></math></p>
<p>The log-likelihood of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><annotation encoding="application/x-tex">y_{t \in T_{k}}</annotation></semantics></math>
is then
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>s</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mfrac><msub><mi>n</mi><mi>k</mi></msub><mn>2</mn></mfrac><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><msub><mi>s</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mfrac><mn>1</mn><mrow><mn>2</mn><msub><mi>s</mi><mi>k</mi></msub></mrow></mfrac><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>−</mo><msub><mi>m</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">
l\left(y_{t \in T_{k}} \left| \mu_t,m_k,\sigma_k,s_k\right.\right) = 
-\frac{n_{k}}{2} \log\left(2\pi s_{k}\right)
-\frac{1}{2}\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right)
-\frac{1}{2s_{k}}\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t - m_{k}\right)^2}{\sigma_{t}}
</annotation></semantics></math></p>
<p>with the cost being twice the negative log likelihood plus a penalty
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
giving</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>m</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>s</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>n</mi><mi>k</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><msub><mi>s</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mfrac><mn>1</mn><msub><mi>s</mi><mi>k</mi></msub></mfrac><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>−</mo><msub><mi>m</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C\left(y_{t \in T_{k}} \left| \mu_t,m_k,\sigma_k,s_k\right.\right) = 
n_{k} \log\left(2\pi s_{k}\right)
+\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right)
+\frac{1}{s_{k}}\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t - m_{k}\right)^2}{\sigma_{t}} + \beta
</annotation></semantics></math></p>
<div class="section level3">
<h3 id="anomaly-in-mean-and-varinace">Anomaly in mean and varinace<a class="anchor" aria-label="anchor" href="#anomaly-in-mean-and-varinace"></a>
</h3>
<p>Estimates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>m</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{m}</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>σ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\sigma}</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
can be selected to minimise the cost by taking
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>m</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub></mrow><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><mn>1</mn><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">
\hat{m}_{k} = \left( \sum\limits_{t \in T_k} \frac{y_t-\mu_t}{\sigma_t} \right)\left(  \sum\limits_{t \in T_k} \frac{1}{\sigma_t}\right)^{-1}
</annotation></semantics></math> and
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>s</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>=</mo><mfrac><mn>1</mn><msub><mi>n</mi><mi>k</mi></msub></mfrac><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>−</mo><msub><mover><mi>m</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">
\hat{s}_{k} = \frac{1}{n_{k}} \sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t - \hat{m}_{k}\right)^2}{\sigma_t}
</annotation></semantics></math></p>
<p>Subsituting these into the cost gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>M</mi><mi>V</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mover><mi>m</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mover><mi>s</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>n</mi><mi>k</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><msub><mover><mi>s</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>n</mi><mi>k</mi></msub><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C_{MV}\left(y_{t \in T_{k}} \left| \mu_t,\hat{m}_k,\sigma_k,\hat{s}_k\right.\right) = 
n_{k} \log\left(2\pi \hat{s}_{k}\right)
+\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right)
+n_{k} + \beta
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="anomaly-in-mean">Anomaly in Mean<a class="anchor" aria-label="anchor" href="#anomaly-in-mean"></a>
</h3>
<p>There is no change in variance so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s_{k}=1</annotation></semantics></math>.
Estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>m</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><annotation encoding="application/x-tex">\hat{m}_{k}</annotation></semantics></math>
is unchanged from that for an anomaly in mean and variance so the
cost</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>M</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mover><mi>m</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>n</mi><mi>k</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>−</mo><msub><mover><mi>m</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C_{M}\left(y_{t \in T_{k}} \left| \mu_t,\hat{m}_k,\sigma_k\right.\right) = 
n_{k} \log\left(2\pi\right)
+\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right)
+\sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t - \hat{m}_{k}\right)^2}{\sigma_t}
+ \beta
</annotation></semantics></math></p>
<p>can be written as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>M</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mover><mi>m</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>n</mi><mi>k</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo>−</mo><msup><mover><mi>m</mi><mo accent="true">̂</mo></mover><mn>2</mn></msup><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><mn>1</mn><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C_{M}\left(y_{t \in T_{k}} \left| \mu_t,\hat{m}_k,\sigma_k\right.\right) = 
n_{k} \log\left(2\pi\right)
+\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right)
+\sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t\right)^2}{\sigma_t}
-\hat{m}^{2} \sum\limits_{t \in T_k} \frac{ 1}{\sigma_t}
+ \beta
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="anomaly-in-variance">Anomaly in Variance<a class="anchor" aria-label="anchor" href="#anomaly-in-variance"></a>
</h3>
<p>These is no mean anomaly so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">m_{k}=0</annotation></semantics></math>.
Estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>s</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><annotation encoding="application/x-tex">\hat{s}_{k}</annotation></semantics></math>
therfore changes to</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>s</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>=</mo><mfrac><mn>1</mn><msub><mi>n</mi><mi>k</mi></msub></mfrac><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">
\hat{s}_{k} = \frac{1}{n_{k}} \sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t\right)^2}{\sigma_t}
</annotation></semantics></math> and cost is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>V</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mover><mi>s</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>n</mi><mi>k</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><msub><mover><mi>s</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>n</mi><mi>k</mi></msub><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C_{V}\left(y_{t \in T_{k}} \left| \mu_t,\sigma_k,\hat{s}_k\right.\right) = 
n_{k} \log\left(2\pi \hat{s}_{k}\right)
+\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right)
+n_{k}
+ \beta
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="no-anomaly-baseline">No Anomaly (Baseline)<a class="anchor" aria-label="anchor" href="#no-anomaly-baseline"></a>
</h3>
<p>Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>k</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">m_{k}=0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s_{k}=1</annotation></semantics></math>
and there is no penalty so</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>B</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>t</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>n</mi><mi>k</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">
C_{B}\left(y_{t \in T_{k}} \left| \mu_t,\sigma_t\right.\right) = 
n_{k} \log\left(2\pi \right)
+\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right)
+\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t\right)^2}{\sigma_{t}} 
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="point-anomaly">Point anomaly<a class="anchor" aria-label="anchor" href="#point-anomaly"></a>
</h3>
<p>A point anomaly at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is treated as a sinle time step with a variance anomaly. Naively the
cost could be computed using the formulea for a variance anomaly as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>t</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><msub><mi>σ</mi><mi>t</mi></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn><mo>+</mo><mi>β</mi><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C_{p}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) = \log\left(2\pi \frac{ \left(y_t-\mu_t\right)^2}{\sigma_t}\right)
+ \log\left(\sigma_{t}\right)
+ 1 + \beta
= \log\left(2\pi\right) + \log \left( \left(y_t-\mu_t\right)^2 \right) + 1 + \beta
</annotation></semantics></math></p>
<p>However the cost of the point anomaly should be higher then the
background cost when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_{t}</annotation></semantics></math>
is, in some sense, close to the background.</p>
<p>Follow Fisch et al. in intorducing a term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
to control this. Using the standardised variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>t</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>t</mi></msub></mrow><msqrt><msub><mi>σ</mi><mi>t</mi></msub></msqrt></mfrac></mrow><annotation encoding="application/x-tex">z_{t} = \frac{y_t-\mu_t}{\sqrt{\sigma_{t}}}</annotation></semantics></math>
the modified cost of a point anomaly is expressed as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>t</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>σ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>γ</mi><mo>+</mo><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C_{p}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) = 
\log\left(2\pi\right) + \log\left(\sigma_{t}\right) + \log \left( \gamma + z_{t}^{2} \right) + 1 + \beta
</annotation></semantics></math></p>
<p>Relating this to the background cost we see that point anomalies may
be accepted in the capa search when
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup><mo>,</mo><mi>γ</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>C</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>t</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>C</mi><mi>B</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>μ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>t</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>γ</mi><mo>+</mo><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn><mo>+</mo><mi>β</mi><mo>−</mo><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">
f\left(z_{t}^2,\gamma,\beta\right) = C_{p}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) - C_{B}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) = \log \left( \gamma + z_{t}^{2} \right) + 1 + \beta - z_{t}^{2} &lt; 0
</annotation></semantics></math></p>
<p>This implies that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
should be selected such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>γ</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f\left(0,\gamma,\beta\right) \geq 0</annotation></semantics></math></p>
<p>The gradient wrt
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">z_{t}^2</annotation></semantics></math>
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>∂</mi><mrow><mi>∂</mi><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup></mrow></mfrac><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup><mo>,</mo><mi>γ</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mi>γ</mi><mo>+</mo><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup></mrow></mfrac><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
\frac{\partial}{\partial z_{t}^2} f\left(z_{t}^2,\gamma,\beta\right)
= \frac{1}{\gamma + z_{t}^{2}} - 1
</annotation></semantics></math></p>
<p>Requiring
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\gamma &lt; 1</annotation></semantics></math>;
which maintains a positive gradient for small z_{t}^2; indicates that
there will no anomalies near 0.</p>
<p>Consider three different definitions of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>.</p>
<ul>
<li>The non corection of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\gamma_{0} = 0</annotation></semantics></math>
which allows point anomalies as z_{t}^2 approaches 0</li>
<li>The correction
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mn>1</mn></msub><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\gamma_{1} = \exp\left(-\beta\right)</annotation></semantics></math>
proposed by Fisch et al.</li>
<li>The minimal correction
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mn>2</mn></msub><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\gamma_{2} = \exp\left(-\left(1+\beta\right)\right)</annotation></semantics></math>
for which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>γ</mi><mn>2</mn></msub><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f\left(0,\gamma_{2},\beta\right) = 0</annotation></semantics></math>.</li>
</ul>
<p>To see the impact of the correct for small
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
the following figure shows
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>z</mi><mi>t</mi><mn>2</mn></msubsup><mo>,</mo><mi>γ</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f\left(z_{t}^2,\gamma,\beta\right)</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\beta=10</annotation></semantics></math>
for the three options.</p>
<p><img src="cost_calcs_files/figure-html/f-1.png" width="672"></p>
<p>It is clear that the difference become small as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
increases. This is supported by the plot below shows the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mi>t</mi></msub><annotation encoding="application/x-tex">z_{t}</annotation></semantics></math>
at which an point anomaly might occur as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
varies. Area above the line are potential anomaly values.</p>
<p><img src="cost_calcs_files/figure-html/when_anaom-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="poisson">Poisson<a class="anchor" aria-label="anchor" href="#poisson"></a>
</h2>
<p>Data belongs to group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
whose time stamps are the set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>k</mi></msub><annotation encoding="application/x-tex">T_{k}</annotation></semantics></math>
can have a multiplicative rate anomaly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>k</mi></msub><annotation encoding="application/x-tex">r_{k}</annotation></semantics></math>
which is common for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">t \in T_{k}</annotation></semantics></math>.
For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">t \in T_{k}</annotation></semantics></math>
this gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>λ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>r</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msubsup><mi>λ</mi><mi>t</mi><msub><mi>y</mi><mi>t</mi></msub></msubsup><msubsup><mi>r</mi><mi>k</mi><msub><mi>y</mi><mi>t</mi></msub></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><msub><mi>r</mi><mi>k</mi></msub><msub><mi>λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
P\left(y_t \left| \lambda_t,r_k\right.\right) = 
\frac{\lambda_{t}^{y_{t}} r_{k}^{y_{t}} \exp\left(-r_{k}\lambda_{t}\right)}{y_{t}!}
</annotation></semantics></math></p>
<p>with the likelihood of of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>k</mi></msub><annotation encoding="application/x-tex">n_{k}</annotation></semantics></math>
observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><annotation encoding="application/x-tex">y_{t \in T_{k}}</annotation></semantics></math>
being
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>λ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>r</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>r</mi><mi>k</mi><mrow><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub></mrow></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><msub><mi>r</mi><mi>k</mi></msub><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><munder><mo>∏</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mfrac><msubsup><mi>λ</mi><mi>t</mi><msub><mi>y</mi><mi>t</mi></msub></msubsup><mrow><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
L\left(y_{t \in T_{k}} \left| \lambda_t,r_k\right.\right) = 
r_{k}^{\sum\limits_{t \in T_{k}} y_{t}} 
\exp\left(-r_{k} \sum\limits_{t \in T_{k}} \lambda_{t}\right)
\prod\limits_{t \in T_{k}} \frac{
\lambda_{t}^{y_{t}} }{ y_{t}!}
</annotation></semantics></math></p>
<p>The log-likelihood of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><annotation encoding="application/x-tex">y_{t \in T_{k}}</annotation></semantics></math>
is then
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>λ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>r</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>r</mi><mi>k</mi></msub><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>λ</mi><mi>t</mi></msub><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
l\left(y_{t \in T_{k}} \left| \lambda_t,r_k\right.\right) = 
\sum\limits_{t \in T_{k}} y_{t} \log\left(r_{k}\right)
- r_{k} \sum\limits_{t \in T_{k}} \lambda_{t}
+ \sum\limits_{t \in T_{k}} y_{t} \log\left(\lambda_{t}\right)
- \sum\limits_{t \in T_{k}} \log\left( y_{t}! \right)
</annotation></semantics></math></p>
<p>with the cost being twice the negative log likelihood plus a penalty
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
giving</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>λ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>r</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>2</mn><msub><mi>r</mi><mi>k</mi></msub><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>λ</mi><mi>t</mi></msub><mo>−</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C\left(y_{t \in T_{k}} \left| \lambda_t,r_k\right.\right) = 
2 r_{k} \sum\limits_{t \in T_{k}} \lambda_{t}
- 2 \sum\limits_{t \in T_{k}} y_{t} \log\left(r_{k}\right)
- 2 \sum\limits_{t \in T_{k}} y_{t} \log\left(\lambda_{t}\right)
+ 2 \sum\limits_{t \in T_{k}} \log\left( y_{t}! \right)
+\beta
</annotation></semantics></math></p>
<div class="section level3">
<h3 id="anomaly-in-rate">Anomaly in rate<a class="anchor" aria-label="anchor" href="#anomaly-in-rate"></a>
</h3>
<p>Estimates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>r</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><annotation encoding="application/x-tex">\hat{r}_{k}</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>k</mi></msub><annotation encoding="application/x-tex">r_{k}</annotation></semantics></math>
can be selected to minimise the cost by taking
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>r</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub></mrow><mrow><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>λ</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\hat{r}_{k} = \frac{ \sum\limits_{t \in T_{k}} y_{t} }{\sum\limits_{t \in T_{k}} \lambda_{t}}
</annotation></semantics></math></p>
<p>This gives a cost of
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>λ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>r</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>r</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C\left(y_{t \in T_{k}} \left| \lambda_t,r_k\right.\right) = 
2 \sum\limits_{t \in T_{k}} y_{t}
- 2 \sum\limits_{t \in T_{k}} y_{t} \log\left(\hat{r}_{k}\right)
- 2 \sum\limits_{t \in T_{k}} y_{t} \log\left(\lambda_{t}\right)
+ 2 \sum\limits_{t \in T_{k}} \log\left( y_{t}! \right)
+ \beta
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="no-anomaly-baseline-1">No Anomaly (Baseline)<a class="anchor" aria-label="anchor" href="#no-anomaly-baseline-1"></a>
</h3>
<p>Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r_{k}=1</annotation></semantics></math>
and there is no penalty so</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>B</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>λ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>r</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>λ</mi><mi>t</mi></msub><mo>−</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msub><mi>T</mi><mi>k</mi></msub></mrow></munder><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
C_{B}\left(y_{t \in T_{k}} \left| \lambda_t,r_k\right.\right) = 
2 \sum\limits_{t \in T_{k}} \lambda_{t}
- 2 \sum\limits_{t \in T_{k}} y_{t} \log\left(\lambda_{t}\right)
+ 2 \sum\limits_{t \in T_{k}} \log\left( y_{t}! \right)
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="point-anomaly-1">Point anomaly<a class="anchor" aria-label="anchor" href="#point-anomaly-1"></a>
</h3>
<p>A point anomaly at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is treated as a single time step rate anomaly. Naively the cost could be
computed using the formulea for a rate anomaly with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>r</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>=</mo><msub><mi>y</mi><mi>t</mi></msub><mi>/</mi><msub><mi>λ</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\hat{r}_{k} = y_{t}/\lambda_{t}</annotation></semantics></math>
giving</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>P</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>λ</mi><mi>t</mi></msub><mo>,</mo><msub><mi>r</mi><mi>k</mi></msub></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>2</mn><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><mn>2</mn><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">
C_{P}\left(y_{t} \left| \lambda_t,r_k\right.\right) = 
2 y_{t}
- 2 y_{t} \log\left(y_{k}\right)
+ 2 \log\left( y_{t}! \right)
+ \beta
</annotation></semantics></math></p>
<p>However the cost of the point anomaly should be higher then the
background cost when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>k</mi></msub><annotation encoding="application/x-tex">r_{k}</annotation></semantics></math>
is, in some sense, close to the background value of 1.</p>
<p>Comparing to the baseline cost for a single point shows that a point
anomaly will exist when</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><msub><mi>y</mi><mi>t</mi></msub><mo>−</mo><mn>2</mn><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>β</mi><mo>&lt;</mo><mn>2</mn><msub><mi>λ</mi><mi>t</mi></msub><mo>−</mo><mn>2</mn><msub><mi>y</mi><mi>t</mi></msub><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>t</mi></msub><mi>!</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
2 y_{t}
- 2 y_{t} \log\left(y_{k}\right)
+ 2 \log\left( y_{t}! \right)
+ \beta
&lt;
2 \lambda_{t}
- 2 y_{t} \log\left(\lambda_{t}\right)
+ 2 \log\left( y_{t}! \right)
</annotation></semantics></math></p>
<p>Rearrangement gives</p>
<p><span class="math display">$$\begin{equation}
\beta
&lt;
2 \left( \lambda_{t} - y_{t} \right)
+ 2 y_{t} \left( \log\left(y_{t}\right) - \log\left(\lambda_{t}\right)
\right) \\
&lt;
2 \lambda_{t} \left( 1 - r_{k} \right)
+ 2 y_{t} \log\left(r_{k}\right) \\
&lt; 2 \lambda_{t} \left( 1 - r_{k} + r_{k}  \log\left(r_{k}\right)
\right)
\end{equation}$$</span></p>
<p>The follwoing plot shows that selection of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
can be selected as a multiple of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
to avoid
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
being to close to 1.</p>
<p><img src="cost_calcs_files/figure-html/f_pois-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="multivariate-gaussian">Multivariate Gaussian<a class="anchor" aria-label="anchor" href="#multivariate-gaussian"></a>
</h2>
<p>A vector of data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math>
of length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
follows a multivariate Gaussian with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛍</mi><annotation encoding="application/x-tex">\mathbf{\mu}</annotation></semantics></math>
and precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝚲</mi><annotation encoding="application/x-tex">\mathbf{\Lambda}</annotation></semantics></math>.</p>
<div class="section level3">
<h3 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>Without any anomalous periods the log liklihood is given by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>𝛍</mi><mo>,</mo><mi>𝚲</mi></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mfrac><mi>p</mi><mn>2</mn></mfrac><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><msup><mi>𝚲</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="true" form="postfix">|</mo></mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo>−</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><mi>𝚲</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo>−</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
l\left(\mathbf{y}\left| \mathbf{\mu}, \mathbf{\Lambda} \right. \right) =
-\frac{p}{2}\log\left(2\pi\right) - \frac{1}{2}\log\left|\mathbf{\Lambda}^{-1}\right| 
- \frac{1}{2} \left(\mathbf{y}-\mathbf{\mu}\right)^{T} \mathbf{\Lambda} 
\left(\mathbf{y}-\mathbf{\mu}\right)
</annotation></semantics></math></p>
<p>or as a cost</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>𝚲</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo>−</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><mi>𝚲</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo>−</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
C\left(\mathbf{y}\left| \mathbf{\mu}, \mathbf{\Sigma} \right. \right) =
p\log\left(2\pi\right) - \log\left|\mathbf{\Lambda}\right| 
+ \left(\mathbf{y}-\mathbf{\mu}\right)^{T} \mathbf{\Lambda} 
\left(\mathbf{y}-\mathbf{\mu}\right)
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="modelling-anomalies">Modelling anomalies<a class="anchor" aria-label="anchor" href="#modelling-anomalies"></a>
</h3>
<p>Consider the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
anomalies occurs of consecuative time steps starting at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><annotation encoding="application/x-tex">s^\left[i\right]</annotation></semantics></math>
and finished at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><annotation encoding="application/x-tex">e^\left[i\right]</annotation></semantics></math>.
Anomalies do not overlap so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>&lt;</mo><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">e^\left[i\right] &lt; s^\left[j\right]</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>i</mi><mo>&lt;</mo><mi>j</mi><mo>&lt;</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">0&lt;i&lt;j&lt;K</annotation></semantics></math></p>
<p>To model change in variance let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ω</mi><annotation encoding="application/x-tex">\Omega</annotation></semantics></math>
be a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">p \times p</annotation></semantics></math>
diagonal matrix where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ω</mi><mrow><mi>t</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><msup><mi>ω</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\Omega_{t,t} = \omega^{\left[i\right]}</annotation></semantics></math>
if there exists
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>≤</mo><mi>t</mi><mo>≤</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">s^\left[i\right] \leq t \leq e^\left[i\right]</annotation></semantics></math>
and 1 otherwise.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
be a length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
vector of mean changes and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>
a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">p \times K</annotation></semantics></math>
matrix where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝐗</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\mathbf{X}_{t,i}=1</annotation></semantics></math>
if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>≤</mo><mi>t</mi><mo>≤</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">s^\left[i\right] \leq t \leq e^\left[i\right]</annotation></semantics></math>
and zero otherwise.</p>
<p>Decomposing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝚲</mi><mo>=</mo><msup><mi>𝐔</mi><mi>T</mi></msup><mi>𝐔</mi></mrow><annotation encoding="application/x-tex">\mathbf{\Lambda} = \mathbf{U}^{T}\mathbf{U}</annotation></semantics></math>
the costs including anomalies becomes</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo>,</mo><mi>δ</mi><mo>,</mo><mi>Ω</mi></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><msup><mi>𝐔</mi><mi>T</mi></msup><mi>Ω</mi><mi>𝐔</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo>−</mo><mi>𝛍</mi><mo>−</mo><mi>𝐗</mi><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><msup><mi>𝐔</mi><mi>T</mi></msup><mi>Ω</mi><mi>𝐔</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo>−</mo><mi>𝛍</mi><mo>−</mo><mi>𝐗</mi><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
C\left(\mathbf{y}\left| \mathbf{\mu}, \mathbf{\Sigma}, \delta, \Omega \right. \right) =
p\log\left(2\pi\right) 
- \log\left| \mathbf{U}^{T}\Omega\mathbf{U} \right| 
+ \left(\mathbf{y}-\mathbf{\mu}-\mathbf{X}\delta\right)^{T} \mathbf{U}^{T}\Omega\mathbf{U} 
\left(\mathbf{y}-\mathbf{\mu}-\mathbf{X}\delta\right)
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="solving-for-omega-and-delta">Solving for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#solving-for-omega-and-delta"></a>
</h3>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐝</mi><mo>=</mo><mi>𝐔</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo>=</mo><mi>μ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{d} = \mathbf{U}\left(\mathbf{y}=\mu\right)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐃</mi><mo>=</mo><mi>𝐔</mi><mi>𝐗</mi></mrow><annotation encoding="application/x-tex">\mathbf{D} = \mathbf{U} \mathbf{X}</annotation></semantics></math>.
Using this the cost is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo>,</mo><mi>δ</mi><mo>,</mo><mi>Ω</mi></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><msup><mi>𝐔</mi><mi>T</mi></msup><mi>Ω</mi><mi>𝐔</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐝</mi><mo>−</mo><mi>𝐃</mi><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><mi>Ω</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐝</mi><mo>−</mo><mi>𝐃</mi><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
C\left(\mathbf{y}\left| \mathbf{\mu}, \mathbf{\Sigma}, \delta, \Omega \right. \right) =
p\log\left(2\pi\right) 
- \log\left| \mathbf{U}^{T}\Omega\mathbf{U} \right| 
+ \left(\mathbf{d} - \mathbf{D}\delta\right)^{T} \Omega 
\left(\mathbf{d} - \mathbf{D}\delta\right)
</annotation></semantics></math></p>
<p>Since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ω</mi><annotation encoding="application/x-tex">\Omega</annotation></semantics></math>
is diagonal
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐝</mi><mo>−</mo><mi>𝐃</mi><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><mi>Ω</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐝</mi><mo>−</mo><mi>𝐃</mi><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn><mo>:</mo><mi>p</mi></mrow></munder><msub><mi>Ω</mi><mrow><mi>t</mi><mo>,</mo><mi>t</mi></mrow></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐝</mi><mi>t</mi></msub><mo>−</mo><msub><mi>𝐃</mi><mrow><mi>t</mi><mo>,</mo><mi>.</mi></mrow></msub><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">
\left(\mathbf{d} - \mathbf{D}\delta\right)^{T} \Omega 
\left(\mathbf{d} - \mathbf{D}\delta\right) = 
\sum\limits_{t=1:p} \Omega_{t,t}\left(\mathbf{d}_{t} - \mathbf{D}_{t,.}\delta\right)^{2}
</annotation></semantics></math></p>
<p>For an non-anoalous time step
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><msup><mi>T</mi><mi>′</mi></msup></mrow><annotation encoding="application/x-tex">t \in T^{\prime}</annotation></semantics></math>
we see that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ω</mi><mrow><mi>t</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\Omega_{t,t}=1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝐃</mi><mrow><mi>t</mi><mo>,</mo><mi>.</mi></mrow></msub><mo>=</mo><mn>𝟎</mn></mrow><annotation encoding="application/x-tex">\mathbf{D}_{t,.}=\mathbf{0}</annotation></semantics></math>
allowing the summation to be written
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn><mo>:</mo><mi>p</mi></mrow></munder><msub><mi>Ω</mi><mrow><mi>t</mi><mo>,</mo><mi>t</mi></mrow></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐝</mi><mi>t</mi></msub><mo>−</mo><msub><mi>𝐃</mi><mrow><mi>t</mi><mo>,</mo><mi>.</mi></mrow></msub><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>=</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>∈</mo><msup><mi>T</mi><mi>′</mi></msup></mrow></munder><msubsup><mi>𝐝</mi><mi>t</mi><mn>2</mn></msubsup><mo>+</mo><munder><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>:</mo><mi>K</mi></mrow></munder><msub><mi>ω</mi><mi>k</mi></msub><munder><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>:</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup></mrow></munder><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐝</mi><mi>t</mi></msub><mo>−</mo><msub><mi>𝐃</mi><mrow><mi>t</mi><mo>,</mo><mi>.</mi></mrow></msub><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">
\sum\limits_{t=1:p} \Omega_{t,t}\left(\mathbf{d}_{t} - \mathbf{D}_{t,.}\delta\right)^{2}=
\sum\limits_{t \in T^{\prime}} \mathbf{d}_{t}^{2} +
\sum\limits_{k=1:K}  \omega_{k} \sum\limits_{t=s^{\left[k\right]}:e^{\left[k\right]}} \left(\mathbf{d}_{t} - \mathbf{D}_{t,.}\delta\right)^{2}
</annotation></semantics></math></p>
<p>Using the identities for determinants gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><msup><mi>𝐔</mi><mi>T</mi></msup><mi>Ω</mi><mi>𝐔</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><msup><mi>𝐔</mi><mi>T</mi></msup><mi>𝐔</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>Ω</mi><mo stretchy="true" form="postfix">|</mo></mrow></mrow><annotation encoding="application/x-tex">
\log\left| \mathbf{U}^{T}\Omega\mathbf{U} \right| =
\log\left| \mathbf{U}^{T}\mathbf{U} \right| + \log\left| \Omega \right|
</annotation></semantics></math> and
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>Ω</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>:</mo><mi>K</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>−</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>log</mo><msub><mi>ω</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">
\log\left| \Omega \right| = \sum\limits_{k=1:K}  \left(s^{\left[k\right]}-e^{\left[k\right]}+1\right) \log \omega_{k}
</annotation></semantics></math></p>
<p>Subsituation of these terms into the cost function gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>∂</mi><mrow><mi>∂</mi><msub><mi>ω</mi><mi>k</mi></msub></mrow></mfrac><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo>,</mo><mi>δ</mi><mo>,</mo><mi>Ω</mi></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>−</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>ω</mi><mi>k</mi></msub></mfrac><mo>+</mo><munder><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><msup><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup><mo>:</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></msup></mrow></munder><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐝</mi><mi>t</mi></msub><mo>−</mo><msub><mi>𝐃</mi><mrow><mi>t</mi><mo>,</mo><mi>.</mi></mrow></msub><mi>δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">
\frac{\partial}{\partial \omega_{k}} C\left(\mathbf{y}\left| \mathbf{\mu}, \mathbf{\Sigma}, \delta, \Omega \right. \right) =
- \frac{\left(s^{\left[k\right]}-e^{\left[k\right]}+1\right)}{\omega_{k}} +
\sum\limits_{t=s^{\left[k\right]}:e^{\left[k\right]}} \left(\mathbf{d}_{t} - \mathbf{D}_{t,.}\delta\right)^{2}
</annotation></semantics></math></p>
<!-- of belongs to group $k$ whose time stamps are the set $T_{k}$ can have additive mean anomaly $m_{k}$ and multiplicative variance anomaly $s_{k}$ which are common for $t \in T_{k}$. -->
<!-- For $t \in T_{k}$ this gives -->
<!-- \[ -->
<!-- P\left(y_t \left| \mu_t,m_k,\sigma_k,s_k\right.\right) = \frac{1}{\sqrt{2\pi\sigma_{t}s_{k}}}\exp\left(-\frac{1}{2\sigma_{t}s_{k}}\left(y_{t} - \mu_t - m_{k}\right)^2\right) -->
<!-- \] -->
<!-- with the likelihood of of the $n_{k}$ observations $y_{t \in T_{k}}$ being -->
<!-- \[ -->
<!-- L\left(y_{t \in T_{k}} \left| \mu_t,m_k,\sigma_k,s_k\right.\right) =  -->
<!-- \left(2\pi s_{k}\right)^{-n_{k}/2}  -->
<!-- \prod\limits_{t \in T_{k}} \sigma_{t}^{-1/2} -->
<!-- \exp\left(-\frac{1}{2s_{k}}\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t - m_{k}\right)^2}{\sigma_{t}}\right) -->
<!-- \] -->
<!-- The log-likelihood of $y_{t \in T_{k}}$ is then  -->
<!-- \[ -->
<!-- l\left(y_{t \in T_{k}} \left| \mu_t,m_k,\sigma_k,s_k\right.\right) =  -->
<!-- -\frac{n_{k}}{2} \log\left(2\pi s_{k}\right) -->
<!-- -\frac{1}{2}\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right) -->
<!-- -\frac{1}{2s_{k}}\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t - m_{k}\right)^2}{\sigma_{t}} -->
<!-- \] -->
<!-- with the cost being twice the negative log likelihood plus a penalty $\beta$ giving  -->
<!-- \[ -->
<!-- C\left(y_{t \in T_{k}} \left| \mu_t,m_k,\sigma_k,s_k\right.\right) =  -->
<!-- n_{k} \log\left(2\pi s_{k}\right) -->
<!-- +\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right) -->
<!-- +\frac{1}{s_{k}}\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t - m_{k}\right)^2}{\sigma_{t}} + \beta -->
<!-- \] -->
<!-- ## Anomaly in mean and varinace -->
<!-- Estimates $\hat{m}$ of $m$ and $\hat{\sigma}$ of $\sigma$ can be selected to minimise the cost by taking -->
<!-- \[ -->
<!-- \hat{m}_{k} = \left( \sum\limits_{t \in T_k} \frac{y_t-\mu_t}{\sigma_t} \right)\left(  \sum\limits_{t \in T_k} \frac{1}{\sigma_t}\right)^{-1} -->
<!-- \] -->
<!-- and -->
<!-- \[ -->
<!-- \hat{s}_{k} = \frac{1}{n_{k}} \sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t - \hat{m}_{k}\right)^2}{\sigma_t} -->
<!-- \] -->
<!-- Subsituting these into the cost gives -->
<!-- \[ -->
<!-- C_{MV}\left(y_{t \in T_{k}} \left| \mu_t,\hat{m}_k,\sigma_k,\hat{s}_k\right.\right) =  -->
<!-- n_{k} \log\left(2\pi \hat{s}_{k}\right) -->
<!-- +\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right) -->
<!-- +n_{k} + \beta -->
<!-- \] -->
<!-- ## Anomaly in Mean -->
<!-- There is no change in variance so $s_{k}=1$. Estimate of $\hat{m}_{k}$ is unchanged from that for an anomaly in mean and variance so the cost -->
<!-- \[ -->
<!-- C_{M}\left(y_{t \in T_{k}} \left| \mu_t,\hat{m}_k,\sigma_k\right.\right) =  -->
<!-- n_{k} \log\left(2\pi\right) -->
<!-- +\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right) -->
<!-- +\sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t - \hat{m}_{k}\right)^2}{\sigma_t} -->
<!-- + \beta -->
<!-- \] -->
<!-- can be written as -->
<!-- \[ -->
<!-- C_{M}\left(y_{t \in T_{k}} \left| \mu_t,\hat{m}_k,\sigma_k\right.\right) =  -->
<!-- n_{k} \log\left(2\pi\right) -->
<!-- +\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right) -->
<!-- +\sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t\right)^2}{\sigma_t} -->
<!-- -\hat{m}^{2} \sum\limits_{t \in T_k} \frac{ 1}{\sigma_t} -->
<!-- + \beta -->
<!-- \] -->
<!-- ## Anomaly in Variance -->
<!-- These is no mean anomaly so $m_{k}=0$. Estimate of $\hat{s}_{k}$ therfore changes to -->
<!-- \[ -->
<!-- \hat{s}_{k} = \frac{1}{n_{k}} \sum\limits_{t \in T_k} \frac{ \left(y_t-\mu_t\right)^2}{\sigma_t} -->
<!-- \] -->
<!-- and cost is -->
<!-- \[ -->
<!-- C_{V}\left(y_{t \in T_{k}} \left| \mu_t,\sigma_k,\hat{s}_k\right.\right) =  -->
<!-- n_{k} \log\left(2\pi \hat{s}_{k}\right) -->
<!-- +\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right) -->
<!-- +n_{k} -->
<!-- + \beta -->
<!-- \] -->
<!-- ## No Anomaly (Baseline) -->
<!-- Here $m_{k}=0$ and $s_{k}=1$ and there is no penalty so -->
<!-- \[ -->
<!-- C_{B}\left(y_{t \in T_{k}} \left| \mu_t,\sigma_t\right.\right) =  -->
<!-- n_{k} \log\left(2\pi \right) -->
<!-- +\sum\limits_{t \in T_{k}} \log\left(\sigma_{t}\right) -->
<!-- +\sum\limits_{t \in T_{k}} \frac{\left(y_{t} - \mu_t\right)^2}{\sigma_{t}}  -->
<!-- \] -->
<!-- ## Point anomaly -->
<!-- A point anomaly at time $t$ is treated as a sinle time step with a variance anomaly. -->
<!-- Naively the cost could be computed using the formulea for a variance anomaly as -->
<!-- \[ -->
<!-- C_{p}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) = \log\left(2\pi \frac{ \left(y_t-\mu_t\right)^2}{\sigma_t}\right) -->
<!-- + \log\left(\sigma_{t}\right) -->
<!-- + 1 + \beta -->
<!-- = \log\left(2\pi\right) + \log \left( \left(y_t-\mu_t\right)^2 \right) + 1 + \beta -->
<!-- \] -->
<!-- However the cost of the point anomaly should be higher then the background cost when $y_{t}$ is, in some sense, close to the background. -->
<!-- Follow Fisch et al. in intorducing a term $\gamma$ to control this. -->
<!-- Using the standardised variable $z_{t} = \frac{y_t-\mu_t}{\sqrt{\sigma_{t}}}$ the modified cost of a point anomaly is expressed as -->
<!-- \[ -->
<!-- C_{p}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) =  -->
<!-- \log\left(2\pi\right) + \log\left(\sigma_{t}\right) + \log \left( \gamma + z_{t}^{2} \right) + 1 + \beta -->
<!-- \] -->
<!-- Relating this to the background cost we see that point anomalies may be accepted in the capa search when -->
<!-- \[ -->
<!-- f\left(z_{t}^2,\gamma,\beta\right) = C_{p}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) - C_{B}\left(y_{t}\left| \mu_{t},\sigma_{t}\right.\right) = \log \left( \gamma + z_{t}^{2} \right) + 1 + \beta - z_{t}^{2} < 0 -->
<!-- \] -->
<!-- This implies that $\gamma$ should be selected such that $f\left(0,\gamma,\beta\right) \geq 0$  -->
<!-- The gradient wrt $z_{t}^2$ is -->
<!-- \[ -->
<!-- \frac{\partial}{\partial z_{t}^2} f\left(z_{t}^2,\gamma,\beta\right) -->
<!-- = \frac{1}{\gamma + z_{t}^{2}} - 1 -->
<!-- \] -->
<!-- Requiring $\gamma < 1$; which maintains a positive gradient for small z_{t}^2; indicates that there will no anomalies near 0. -->
<!-- Consider three different definitions of $\gamma$. -->
<!-- - The non corection of $\gamma_{0} = 0$ which allows point anomalies as z_{t}^2 approaches 0 -->
<!-- - The correction $\gamma_{1} = \exp\left(-\beta\right)$ proposed by Fisch et al. -->
<!-- - The minimal correction $\gamma_{2} = \exp\left(-\left(1+\beta\right)\right)$ for which $f\left(0,\gamma_{2},\beta\right) = 0$. -->
<!-- To see the impact of the correct for small $z$ the following figure shows  -->
<!-- $f\left(z_{t}^2,\gamma,\beta\right)$ for $\beta=10$ for the three options. -->
<!-- ```{r echo=FALSE, f, fig.width=7, fig.height=7} -->
<!-- fz <- function(zsq,gamma,beta){ log(gamma+zsq) + 1 + beta - zsq } -->
<!-- zsq <- seq(0,1e-3,length=10000) -->
<!-- Y <- matrix(NA,length(zsq),3) -->
<!-- colnames(Y) <- c("gamma_0","gamma_1","gamma_2") -->
<!-- b <- 10 -->
<!-- Y[,1] <- fz(zsq,0,b) -->
<!-- Y[,2] <- fz(zsq,exp(-b),10) -->
<!-- Y[,3] <- fz(zsq,exp(-(1+b)),10) -->
<!-- matplot(sqrt(zsq),Y,type="l",xlab="z",ylab="f(z,gamma,10)"); -->
<!-- legend("bottomright",colnames(Y),col=1:3,lty=1:3) -->
<!-- ``` -->
<!-- It is clear that the difference become small as $z$ increases. This is supported by the plot below shows the value of $z_{t}$ at which an point anomaly might occur as $\beta$ varies. Area above the line are potential anomaly values. -->
<!-- ```{r echo=FALSE, when_anaom, fig.width=7, fig.height=7} -->
<!-- betaRng <- seq(log(2),2*log(10),length=1000) ###2*log(1:1000) -->
<!-- Y <- matrix(NA,length(betaRng),3) -->
<!-- colnames(Y) <- c("gamma_0","gamma_1","gamma_2") -->
<!-- for(ii in 1:length(betaRng)){ -->
<!--     rng <- c(1.25,25) -->
<!--     b <- betaRng[ii] -->
<!--     Y[ii,1] <- uniroot(fz,rng,gamma=0,beta=b)$root -->
<!--     Y[ii,2] <- uniroot(fz,rng,gamma=exp(-b),beta=b)$root -->
<!--     Y[ii,3] <- uniroot(fz,rng,gamma=exp(-(1+b)),beta=b)$root -->
<!-- } -->
<!-- matplot(betaRng,sqrt(Y),type="l",xlab="beta",ylab="z"); -->
<!-- legend("bottomright",colnames(Y),col=1:3,lty=1:3) -->
<!-- ``` -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
